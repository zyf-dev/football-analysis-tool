<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å©šæ‹å¸‚åœºéš¾åº¦è¯„ä¼°è¾…åŠ©ç³»ç»Ÿ (V12.1 - ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆ)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f4f7fa; color: #333; line-height: 1.6; }
        .container { max-width: 1600px; margin: 30px auto; display: flex; gap: 30px; align-items: flex-start; padding: 0 30px; }
        .form-section { flex: 1; min-width: 400px; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); padding: 30px; position: sticky; top: 30px; }
        .result-section { flex: 2.5; min-width: 600px; }
        h1, h2, h3 { font-weight: 700; color: #1a3b5d; }
        h1 { font-size: 2rem; margin-bottom: 5px; }
        h1 i { color: #8e44ad; }
        .subtitle { font-size: 1.1rem; color: #5a7b9d; margin-bottom: 20px; }
        .disclaimer { font-size: 1.2rem; font-weight: 700; color: #d9534f; background-color: #f2dede; border: 1px solid #ebccd1; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; }
        .calc-mode-display { font-size: 0.85rem; color: #004085; background-color: #cce5ff; border-color: #b8daff; padding: 8px; border-radius: 5px; margin-bottom: 20px; display: none; }
        label { font-weight: 500; font-size: 0.95rem; margin-bottom: 8px; display: flex; align-items: center; }
        input, select { width: 100%; padding: 12px 15px; border: 1px solid #ced4da; border-radius: 8px; font-size: 1rem; margin-bottom: 20px; background-color: #fdfdfd; }
        .input-group { display:flex; gap:10px; } /* Added for age inputs */
        .btn-container { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn { border: none; padding: 12px; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;}
        .btn:disabled { background-color: #adb5bd; cursor: not-allowed; }
        #calculateBtn { background-color: #8e44ad; color: #fff; } #calculateBtn:hover { background-color: #703688; }
        #saveBtn { background-color: #28a745; color: #fff; } #saveBtn:hover { background-color: #218838; }
        #resetBtn { background-color: #6c757d; color: #fff; } #resetBtn:hover { background-color: #5a6268; }
        .result-box { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 30px; position: relative; }
        h2 { font-size: 1.8rem; margin-bottom: 25px; }
        sup { font-size: 0.8rem; color: #8e44ad; font-weight: bold; margin-left: 2px; }
        h3 { font-size: 1.4rem; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; }
        .chart-container { height: 350px; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .criteria-list { list-style: none; padding: 0; columns: 2; -webkit-columns: 2; -moz-columns: 2; gap: 10px; }
        .criteria-list li { background: #e9ecef; padding: 5px 12px; border-radius: 5px; margin-bottom: 8px; font-size: 0.9rem; }
        .loader { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.85); display: none; justify-content: center; align-items: center; z-index: 10; border-radius: 12px; font-size: 1.2rem; font-weight: 500; color: #1a3b5d; }
        .loader.active { display: flex; }
        .methodology-section ul, .reality-check-section ul { padding-left: 0; list-style-type: none; }
        .methodology-section li, .reality-check-section li { margin-bottom: 15px; position: relative; padding-left: 25px; }
        .methodology-section .sub-heading, .reality-check-section .sub-heading { font-weight: 700; color: #0056b3; margin-top: 20px; display: block; }
        .reality-check-section li::before { content: 'ğŸ’¡'; position: absolute; left: 0; font-size: 1.2em; }
        .help-icon { margin-left: 5px; color: #007bff; cursor: pointer; font-size: 0.9em; }
        #tooltip { position: absolute; background-color: #333; color: #fff; padding: 10px 15px; border-radius: 5px; z-index: 999; font-size: 0.9rem; max-width: 300px; display: none; }
        #comparison-section { display: none; }
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .comparison-table th, .comparison-table td { padding: 12px 15px; border: 1px solid #dee2e6; text-align: center; }
        .comparison-table th { background-color: #f8f9fa; font-weight: 500; }
        .comparison-table .header-row th { background-color: #e9ecef; font-weight: 700; }
        .comparison-table .label-col { text-align: left; font-weight: 500; }

        /* ****** START: MODIFIED CSS FOR 'å¸‚åœºè§„æ¨¡ä¸ç«äº‰è¯„ä¼°' ****** */
        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .stat-card { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 10px; padding: 20px; text-align: left; display: flex; flex-direction: column; transition: all 0.2s ease-in-out; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
        .stat-card-header { display: flex; align-items: center; margin-bottom: 15px; }
        .stat-card-header i { font-size: 1.5rem; margin-right: 15px; width: 30px; text-align: center; }
        .result-card-title { font-weight: 500; color: #5a7b9d; font-size: 1rem; }
        .result-card-value { font-size: 2.3rem; font-weight: 700; line-height: 1.1; margin-bottom: 10px; color: #1a3b5d; }
        .result-card-desc { font-size: 0.85rem; color: #6c757d; flex-grow: 1; }
        .stat-card .fa-users { color: #007bff; }
        .stat-card .fa-heart-pulse { color: #6f42c1; }
        .stat-card .fa-handshake-simple { color: #28a745; }
        .stat-card .fa-gauge-high { color: #d9534f; }
        /* ****** END: MODIFIED CSS ****** */

        @media (max-width: 1200px) { .container { flex-direction: column; } .form-section { position: static; max-width: none; } }
        @media (max-width: 768px) {
            .container { padding: 0 15px; margin: 15px auto; gap: 20px;}
            .form-section, .result-box { padding: 20px; }
            h1 { font-size: 1.8rem; } h2 { font-size: 1.5rem; }
            .btn-container { grid-template-columns: 1fr; }
            .result-grid { grid-template-columns: 1fr; } 
            .summary-grid, .criteria-list { columns: 1; -webkit-columns: 1; -moz-columns: 1; }
            .disclaimer { font-size: 1rem; }
            .result-card-value { font-size: 2rem; }

            /* ****** START: MOBILE UI OPTIMIZATIONS V12.1 ****** */
            .input-group { flex-direction: column; }
            .comparison-table thead { display: none; }
            .comparison-table tr, .comparison-table td { display: block; width: 100%; }
            .comparison-table tr { margin-bottom: 15px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
            .comparison-table td { text-align: right; padding-left: 50%; position: relative; border: none; border-bottom: 1px solid #e9ecef; }
            .comparison-table tr td:last-child { border-bottom: none; }
            .comparison-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 15px;
                width: calc(50% - 30px);
                text-align: left;
                font-weight: 500;
                color: #5a7b9d;
            }
            .comparison-table .label-col { background-color: #f8f9fa; font-weight: 700; text-align: left; padding-left: 15px; }
            .comparison-table .label-col::before { display: none; }
            /* ****** END: MOBILE UI OPTIMIZATIONS V12.1 ****** */
        }
    </style>
</head>
<body>
    <div class="container">
        <form class="form-section" id="filter-form">
            <h1><i class="fas fa-chess-queen"></i> å©šæ‹å¸‚åœºéš¾åº¦è¯„ä¼°è¾…åŠ©ç³»ç»Ÿ</h1>
            <p class="subtitle">V12.1 - ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆ</p>
            <div class="disclaimer">æ‰€æœ‰ç»“æœå‡ä¸ºå®è§‚ä¼°ç®—ï¼Œè¯·ç»“åˆç°å®ç†æ€§çœ‹å¾…</div>
            <div id="calc-mode-display" class="calc-mode-display"></div>
            
            <label for="province">ç›®æ ‡åœ°åŒº</label>
            <select id="province" name="location"></select>
            
            <label for="gender">ç›®æ ‡æ€§åˆ«</label>
            <select id="gender" name="gender"><option value="male">ç”·æ€§</option><option value="female">å¥³æ€§</option></select>
            
            <label>å¹´é¾„èŒƒå›´</label>
            <div class="input-group"><input type="number" id="minAge" name="minAge" placeholder="æœ€å°å¹´é¾„"><input type="number" id="maxAge" name="maxAge" placeholder="æœ€å¤§å¹´é¾„"></div>

            <label for="maritalStatus">å©šå§»çŠ¶å†µ <i class="fas fa-info-circle help-icon" data-tooltip="æ­¤é¡¹ä¸ºé‡è¦ç­›é€‰æ¡ä»¶ã€‚ç³»ç»Ÿå°†åŸºäºå¹´é¾„ä¼°ç®—å„ç±»å©šå§»çŠ¶å†µçš„äººå£æ¯”ä¾‹ã€‚"></i></label>
            <select id="maritalStatus" name="maritalStatus">
                <option value="any">ä¸é™</option>
                <option value="unmarried">ä»…é™æœªå©š</option>
                <option value="divorced_no_kids">ä»…é™ç¦»å¼‚(æ— å­å¥³)</option>
                <option value="divorced_with_kids">ä»…é™ç¦»å¼‚(æœ‰å­å¥³)</option>
                <option value="unmarried_or_divorced">æœªå©šæˆ–ç¦»å¼‚å‡å¯</option>
            </select>

            <label for="education">å­¦å†è¦æ±‚</label>
            <select id="education" name="education"><option value="any">ä¸é™</option><option value="college">å¤§ä¸“åŠä»¥ä¸Š</option><option value="bachelor">æœ¬ç§‘åŠä»¥ä¸Š</option><option value="master">ç¡•å£«åŠä»¥ä¸Š</option></select>

            <label for="height">èº«é«˜è¦æ±‚ (cm)</label>
            <select id="height" name="height"><option value="0">ä¸é™</option><option value="155">155+</option><option value="160">160+</option><option value="165">165+</option><option value="170">170+</option><option value="175">175+</option><option value="180">180+</option><option value="185">185+</option></select>

            <label for="income">æœ€ä½æœˆæ”¶å…¥ (å…ƒ) <i class="fas fa-info-circle help-icon" data-tooltip="æŒ‡ä¸ªäººç¨å‰æœˆæ”¶å…¥ã€‚"></i></label>
            <select id="income" name="income"><option value="0">ä¸é™</option><option value="5000">5000+</option><option value="8000">8000+</option><option value="10000">10000+</option><option value="15000">15000+</option><option value="20000">20000+</option><option value="30000">30000+</option></select>

            <label for="assets">å®¶åº­å‡€èµ„äº§ <i class="fas fa-info-circle help-icon" data-tooltip="æŒ‡ä¸ªä½“åŸç”Ÿå®¶åº­ä¸æœ¬äººæ‰€æ‹¥æœ‰èµ„äº§å‡å»æ€»è´Ÿå€ºåçš„æ€»å’Œã€‚"></i></label>
            <select id="assets" name="assets"><option value="0">ä¸é™</option><option value="50">50ä¸‡+</option><option value="100">100ä¸‡+</option><option value="200">200ä¸‡+</option><option value="500">500ä¸‡+</option><option value="1000">1000ä¸‡+</option></select>
            
            <label for="house">æˆ¿äº§è¦æ±‚ <i class="fas fa-info-circle help-icon" data-tooltip="â€œæœ‰æˆ¿â€åŒ…å«å…¨æ¬¾ä¸è´·æ¬¾ä¸¤ç§æƒ…å†µã€‚"></i></label>
            <select id="house" name="house"><option value="any">ä¸é™</option><option value="owned_any">æœ‰æˆ¿(å«è´·æ¬¾)</option><option value="owned_full">æœ‰å…¨æ¬¾æˆ¿</option></select>
            
            <div class="btn-container">
                <button id="calculateBtn" type="button" class="btn"><i class="fas fa-calculator"></i> ç”ŸæˆæŠ¥å‘Š</button>
                <button id="saveBtn" type="button" class="btn"><i class="fas fa-save"></i> ä¿å­˜å¯¹æ¯”</button>
                <button id="resetBtn" type="button" class="btn"><i class="fas fa-sync-alt"></i> é‡ç½®</button>
            </div>
        </form>

        <div class="result-section">
            <div id="comparison-section" class="result-box">
                 <h3><i class="fas fa-exchange-alt"></i> æ¨ªå‘å¯¹æ¯”åˆ†æ</h3>
                 <div id="comparison-content"></div>
            </div>
        
            <div class="result-box">
                <div class="loader" id="loader"><span><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</span></div>
                <h3><i class="fas fa-file-alt"></i> åˆ†ææŠ¥å‘Šæ¦‚è¦</h3>
                <ul id="criteria-summary" class="criteria-list"></ul>
            </div>

            <div class="result-box">
                <h2><i class="fas fa-bullseye"></i> å¸‚åœºè§„æ¨¡ä¸ç«äº‰è¯„ä¼° <sup>[1]</sup></h2>
                <div class="result-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <i class="fas fa-users"></i>
                            <p class="result-card-title">ç†è®ºç¬¦åˆæ€»äººæ•°</p>
                        </div>
                        <p class="result-card-value" id="res-total">0</p>
                        <p class="result-card-desc">åŸºäºæ‚¨çš„æ‰€æœ‰æ¡ä»¶ï¼Œåœ¨ç›®æ ‡åœ°åŒºç†è®ºä¸Šå­˜åœ¨çš„äººæ•°æ€»é‡ã€‚</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <i class="fas fa-heart-pulse"></i>
                            <p class="result-card-title">æ´»è·ƒå¯»ç¼˜äººæ•°</p>
                        </div>
                        <p class="result-card-value" id="res-market">0</p>
                        <p class="result-card-desc">ä»ç†è®ºæ€»äººæ•°ä¸­ï¼Œä¼°ç®—å‡ºå½“å‰æ­£åœ¨ç§¯æå¯»æ‰¾ä¼´ä¾£çš„äººæ•°è§„æ¨¡ã€‚</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <i class="fas fa-handshake-simple"></i>
                             <p class="result-card-title">å®é™…åŒ¹é…æ± </p>
                        </div>
                        <p class="result-card-value" id="res-potential">0</p>
                        <p class="result-card-desc">æ´»è·ƒäººæ•°ä¸­ï¼Œè€ƒè™‘åˆ°åŒå‘é€‰æ‹©ã€åœˆå±‚ç­‰å› ç´ åï¼Œæ‚¨æœ€å¯èƒ½æ¥è§¦çš„æ ¸å¿ƒäººç¾¤ã€‚</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <i class="fas fa-gauge-high"></i>
                            <p class="result-card-title">ç«äº‰æŒ‡æ•°</p>
                        </div>
                        <p class="result-card-value" id="res-competition">--</p>
                        <p class="result-card-desc">ç»¼åˆè¯„ä¼°æ‚¨çš„æ ‡å‡†ä¸¥è‹›ç¨‹åº¦ã€‚æŒ‡æ•°è¶Šé«˜ï¼Œç›®æ ‡äººç¾¤é€‰æ‹©é¢è¶Šå¹¿ï¼Œéš¾åº¦è¶Šå¤§ã€‚</p>
                    </div>
                </div>
            </div>

             <div class="result-box">
                <h3><i class="fas fa-chart-pie"></i> è®¡ç®—æ‘˜è¦ <sup>[2]</sup></h3>
                <div class="summary-grid">
                    <div class="summary-item"><p class="summary-label">ç›®æ ‡åœ°åŒºæ€»é€‚é¾„äººå£</p><p class="summary-value" id="res-base-pop">0</p></div>
                    <div class="summary-item"><p class="summary-label">ç»¼åˆç­›é€‰é€šè¿‡ç‡</p><p class="summary-value" id="res-pass-rate">0%</p></div>
                </div>
             </div>

             <div class="result-box">
                <h3><i class="fas fa-filter"></i> å„æ¡ä»¶ç­›é€‰å¼ºåº¦ (%) <sup>[3]</sup></h3>
                <div class="chart-container"><canvas id="impactChart"></canvas></div>
            </div>

            <div class="result-box reality-check-section">
                <h3><i class="fas fa-street-view"></i> ç°å®å› ç´ ä¸ç­–ç•¥å»ºè®®</h3>
                <ul>
                    <li>
                        <span class="sub-heading">åŒå‘é€‰æ‹©çš„ç°å®</span>
                        æŠ¥å‘Šç»“æœä»…ä¸ºå•å‘ç­›é€‰ã€‚è¯·è°¨è®°ï¼Œæ‚¨æ‰€å¯»æ‰¾çš„â€œç†æƒ³å‹â€åŒæ ·æ‹¥æœ‰è‡ªå·±çš„æ‹©å¶æ ‡å‡†ã€‚ç«äº‰æŒ‡æ•°è¶Šé«˜ï¼Œæ„å‘³ç€ç›®æ ‡å¯¹è±¡çš„é€‰æ‹©é¢è¶Šå¹¿ï¼Œå…¶å¯¹ä¼´ä¾£çš„è¦æ±‚ä¹Ÿç›¸åº”è¶Šè‹›åˆ»ã€‚
                    </li>
                     <li>
                        <span class="sub-heading">ç¤¾äº¤åœˆå±‚çš„å£å’</span>
                        â€œç†è®ºäººæ•°â€ä¸ç­‰äºâ€œå¯æ¥è§¦äººæ•°â€ã€‚ä¼˜è´¨äººç¾¤å¾€å¾€æ²‰æ·€åœ¨ç‰¹å®šçš„å·¥ä½œã€ç”Ÿæ´»ä¸ç¤¾äº¤åœˆå±‚ä¸­ã€‚è¯„ä¼°æ‚¨å½“å‰çš„ç¤¾äº¤åŠå¾„æ˜¯å¦èƒ½æœ‰æ•ˆè¦†ç›–ç›®æ ‡äººç¾¤ï¼Œæ˜¯æ¯”æ•°å­—æ›´é‡è¦çš„é—®é¢˜ã€‚
                    </li>
                     <li>
                        <span class="sub-heading">æ— æ³•é‡åŒ–çš„éšæ€§å› ç´ </span>
                        æ¨¡å‹æ— æ³•è¡¡é‡æ€§æ ¼ã€ä¸‰è§‚ã€å®¶åº­æ°›å›´ã€åŸç”Ÿå®¶åº­æ”¯æŒåº¦ã€ä¸ªäººå€ºåŠ¡ç­‰å…³é”®â€œè½¯ä»¶â€ã€‚ç¡¬ä»¶åŒ¹é…åªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒçœŸæ­£çš„æŒ‘æˆ˜åœ¨äºè½¯æ€§å› ç´ çš„ç£¨åˆã€‚
                    </li>
                </ul>
            </div>

            <div class="result-box">
                <h3><i class="fas fa-database"></i> æ•°æ®æ¥æºä¸æ–¹æ³•è®º</h3>
                <ul class="methodology-section" id="methodology-section">
                     <span class="sub-heading">æ•°æ®æ¥æºï¼š</span>
                     <li><strong>äººå£ä¸æ€§åˆ«æ¯”:</strong> æ¥æºäºå„åœ°ç»Ÿè®¡å±€å‘å¸ƒçš„ã€Š2023å¹´å›½æ°‘ç»æµå’Œç¤¾ä¼šå‘å±•ç»Ÿè®¡å…¬æŠ¥ã€‹ã€‚</li>
                     <li><strong>å­¦å†ç»“æ„:</strong> æ¥æºäºå›½å®¶ç»Ÿè®¡å±€ã€Šç¬¬ä¸ƒæ¬¡å…¨å›½äººå£æ™®æŸ¥å…¬æŠ¥ã€‹(2020å¹´)ï¼Œè¿™æ˜¯ç›®å‰æœ€æƒå¨çš„äººå£æ•™è‚²èƒŒæ™¯æ•°æ®ã€‚</li>
                     <li><strong>æ”¶å…¥/èµ„äº§/æˆ¿äº§/èº«é«˜åˆ†å¸ƒ:</strong> ç”±äºå®˜æ–¹æœªå‘å¸ƒæ­¤ç±»ç»†ç²’åº¦äº¤å‰æ•°æ®ï¼Œæœ¬å·¥å…·æ²¿ç”¨åŸºäºå…¬å¼€æ•°æ®å’Œç»æµå­¦è¶‹åŠ¿å»ºç«‹çš„**åˆ†å±‚æ¦‚ç‡æ¨¡å‹**è¿›è¡Œä¼°ç®—ã€‚è¿™å¹¶éåŸå§‹æ•°æ®ï¼Œè€Œæ˜¯ä¸ºäº†æ¨¡æ‹ŸçœŸå®ç¤¾ä¼šä¸­â€œé«˜å­¦å†è€…æœ‰æ›´å¤§æ¦‚ç‡è·å¾—é«˜æ”¶å…¥â€ç­‰å…³è”ç°è±¡ã€‚</li>
                    
                     <span class="sub-heading">æ ¸å¿ƒæ–¹æ³•è®ºï¼š</span>
                     <li><sup>[1]</sup> <strong>Persona Cohort Model (äººç¾¤ç”»åƒåˆ†å±‚æ¨¡å‹)</strong><br>åŸºäºâ€œå­¦å†â€å°†äººå£é¢„å…ˆåˆ†å±‚ï¼Œæ¯ä¸ªå­¦å†ç¾¤ä½“æ‹¥æœ‰ç‹¬ç«‹çš„å±æ€§åˆ†å¸ƒï¼Œä»æ ¹æœ¬ä¸Šä¿è¯äº†è®¡ç®—çš„å¯é æ€§ã€‚</li>
                     <li><sup>[2]</sup> <strong>Graduated Conditional Probability (é˜¶æ¢¯å¼æ¡ä»¶æ¦‚ç‡)</strong><br>æ¨¡å‹èƒ½å¤Ÿæ™ºèƒ½è¯†åˆ«å˜é‡é—´çš„å†…åœ¨å…³è”ï¼ˆå¦‚é«˜èµ„äº§ä¸é«˜æˆ¿äº§æ¦‚ç‡ï¼‰ï¼Œé¿å…äº†å¯¹ä¼˜ç§€ä¸ªä½“çš„â€œæƒ©ç½šæ€§å åŠ â€ç­›é€‰ã€‚</li>
                     <li><sup>[3]</sup> <strong>Marginal Impact Analysis (è¾¹é™…å½±å“åˆ†æ)</strong><br>é€šè¿‡ç‹¬ç«‹è®¡ç®—æ¯ä¸ªæ¡ä»¶çš„â€œè¾¹é™…å½±å“â€ï¼Œæ¸…æ™°å±•ç¤ºå“ªä¸ªæ¡ä»¶æœ€ä¸¥è‹›ï¼Œä½¿å¾—æ¨¡å‹ç»“æœå¯è§£é‡Šã€å¯å½’å› ã€‚</li>
                </ul>
            </div>
        </div>
    </div>
<div id="tooltip"></div>

<script>
// The Javascript content has been slightly modified to handle the responsive table.
document.addEventListener('DOMContentLoaded', function() {
    const getEl = (id) => document.getElementById(id);
    let impactChart = null;
    let savedResultForComparison = null;

    // Database object remains the same...
    const db = {
        locations: {
            "åŒ—äº¬å¸‚":{p:2185,g:101.9,e:{m:0.076,b:0.344,c:0.191,o:0.389}}, "ä¸Šæµ·å¸‚":{p:2487,g:105.5,e:{m:0.058,b:0.286,c:0.211,o:0.445}},
            "å¹¿å·å¸‚":{p:1882,g:111.6,e:{m:0.033,b:0.237,c:0.264,o:0.466}}, "æ·±åœ³å¸‚":{p:1779,g:115.7,e:{m:0.039,b:0.288,c:0.267,o:0.406}},
            "æ­å·å¸‚":{p:1252,g:107.5,e:{m:0.037,b:0.268,c:0.245,o:0.450}}, "å—äº¬å¸‚":{p:954, g:105.8,e:{m:0.054,b:0.291,c:0.211,o:0.444}},
            "è‹å·å¸‚":{p:1295,g:107.1,e:{m:0.019,b:0.180,c:0.252,o:0.549}}, "æˆéƒ½å¸‚":{p:2140,g:103.5,e:{m:0.027,b:0.218,c:0.261,o:0.494}},
            "é‡åº†å¸‚":{p:3213,g:102.4,e:{m:0.015,b:0.143,c:0.207,o:0.635}}, "æ­¦æ±‰å¸‚":{p:1377,g:106.3,e:{m:0.036,b:0.245,c:0.247,o:0.472}},
            "è¥¿å®‰å¸‚":{p:1307,g:104.9,e:{m:0.039,b:0.247,c:0.239,o:0.475}}, "é•¿æ²™å¸‚":{p:1055,g:104.2,e:{m:0.029,b:0.219,c:0.272,o:0.480}},
            "éƒ‘å·å¸‚":{p:1300,g:100.9,e:{m:0.018,b:0.170,c:0.263,o:0.549}}, "é’å²›å¸‚":{p:1037,g:101.3,e:{m:0.023,b:0.176,c:0.235,o:0.566}},
            "åˆè‚¥å¸‚":{p:985, g:106.1,e:{m:0.029,b:0.198,c:0.222,o:0.551}}, "ç¦å·å¸‚":{p:846, g:106.9,e:{m:0.022,b:0.172,c:0.217,o:0.589}}
        },
        personas: {
            master:   { n: "ç¡•å£«+", i: v => v > 0 ? Math.exp(-((v / 35000)**1.8)) : 1, a: v => v > 0 ? Math.exp(-((v / 400)**1.5)) : 1, h: v => v==='any'?1:v==='owned_any'?0.80:0.45},
            bachelor: { n: "æœ¬ç§‘",  i: v => v > 0 ? Math.exp(-((v / 18000)**1.5)) : 1, a: v => v > 0 ? Math.exp(-((v / 150)**1.5)) : 1, h: v => v==='any'?1:v==='owned_any'?0.65:0.25},
            college:  { n: "å¤§ä¸“",  i: v => v > 0 ? Math.exp(-((v / 9000)**1.3)) : 1,  a: v => v > 0 ? Math.exp(-((v / 60)**1.3))  : 1, h: v => v==='any'?1:v==='owned_any'?0.50:0.12},
            other:    { n: "é«˜ä¸­+", i: v => v > 0 ? Math.exp(-((v / 6000)**1.2)) : 1,  a: v => v > 0 ? Math.exp(-((v / 30)**1.2))  : 1, h: v => v==='any'?1:v==='owned_any'?0.40:0.08}
        },
        heightDist: { male: {155:0.99,160:0.95,165:0.82,170:0.55,175:0.25,180:0.08,185:0.02}, female: {155:0.75,160:0.45,165:0.18,170:0.05,175:0.01,180:0.001} },
        filterLabels: { maritalStatus: "å©šå§»çŠ¶å†µ", education: "å­¦å†", height: "èº«é«˜", income: "æ”¶å…¥", assets: "èµ„äº§", house: "æˆ¿äº§" },
        universalProb: { 
            income: v => v > 0 ? Math.exp(-((v/10000)**1.4)) * 0.5 : 1,
            assets: v => v > 0 ? Math.exp(-((v/80)**1.3)) * 0.5 : 1
        }
    };
    
    const defaultInputs = { location: 'æˆéƒ½å¸‚', gender: 'male', minAge: 28, maxAge: 35, maritalStatus: 'unmarried', education: 'bachelor', height: '170', income: '10000', assets: '100', house: 'owned_any' };

    const elements = {
        form: getEl('filter-form'), province: getEl('province'), loader: getEl('loader'), calcModeDisplay: getEl('calc-mode-display'),
        resTotal: getEl('res-total'), resMarket: getEl('res-market'), resPotential: getEl('res-potential'), resCompetition: getEl('res-competition'),
        resBasePop: getEl('res-base-pop'), resPassRate: getEl('res-pass-rate'),
        impactChartCanvas: getEl('impactChart'), criteriaSummary: getEl('criteria-summary'),
        calculateBtn: getEl('calculateBtn'), resetBtn: getEl('resetBtn'), saveBtn: getEl('saveBtn'),
        tooltip: getEl('tooltip'), comparisonSection: getEl('comparison-section'), comparisonContent: getEl('comparison-content')
    };

    function init() {
        Object.keys(db.locations).forEach(loc => elements.province.add(new Option(loc, loc)));
        elements.calculateBtn.addEventListener('click', () => handleCalculate(false));
        elements.saveBtn.addEventListener('click', () => handleCalculate(true));
        elements.resetBtn.addEventListener('click', resetForm);
        setupTooltips();
        resetForm(true); 
    }

    function resetForm(isInitialLoad = false) {
        Object.keys(defaultInputs).forEach(key => {
            if (key === 'minAge' || key === 'maxAge') {
                 elements.form.elements[key].value = defaultInputs[key];
                 return;
            }
            const el = elements.form.elements[key];
            if (el) {
                if (el.options) {
                    el.value = defaultInputs[key];
                }
            }
        });
        savedResultForComparison = null;
        elements.comparisonSection.style.display = 'none';
        elements.saveBtn.disabled = false;
        elements.saveBtn.innerHTML = '<i class="fas fa-save"></i> ä¿å­˜å¯¹æ¯”';
        if (!isInitialLoad) {
            handleCalculate(false, true); 
        }
    }
    
    // ... all calculation functions like getUnmarriedRate, calculatePopulation etc remain the same ...
     function getUnmarriedRate(age) { if (age <= 25) return 0.90; if (age <= 30) return 0.60; if (age <= 35) return 0.30; if (age <= 40) return 0.15; return 0.08; }
    function getDivorceRate(age) { if (age <= 30) return 0.03; if (age <= 35) return 0.06; if (age <= 40) return 0.08; if (age <= 50) return 0.12; return 0.10; }
    function getDynamicRatios(passRate) { if (passRate >= 0.05) { return { activeRate: 0.5, matchRate: 0.30 }; } else if (passRate >= 0.01) { return { activeRate: 0.4, matchRate: 0.25 }; } else if (passRate >= 0.001) { return { activeRate: 0.3, matchRate: 0.15 }; } else { return { activeRate: 0.2, matchRate: 0.10 }; } }
    function getCompetitionIndex(passRate) { if (passRate >= 0.05) return { label: "ä¸­ç­‰", color: '#28a745' }; if (passRate >= 0.01) return { label: "è¾ƒé«˜", color: '#5bc0de' }; if (passRate >= 0.005) return { label: "å›°éš¾", color: '#f0ad4e' }; if (passRate >= 0.001) return { label: "æéš¾", color: '#d9534f' }; return { label: "åœ°ç‹±", color: '#8e44ad' }; }
    let outlierModeActive = false, potentialModeActive = false;
    function calculatePopulation(inputs) { let totalEligible = 0, basePopulation = 0; outlierModeActive = false; potentialModeActive = false; const loc = db.locations[inputs.location]; const agePopRatioPerYear = 0.014; const totalGenderRatio = 100 + loc.g; const maleRatio = loc.g / totalGenderRatio; const femaleRatio = 100 / totalGenderRatio; for (let age = inputs.minAge; age <= inputs.maxAge; age++) { let basePopForAge = loc.p * 10000 * agePopRatioPerYear; let maritalStatusModifier = 1.0; const unmarriedRate = getUnmarriedRate(age); const divorcedRate = getDivorceRate(age); const divorcedNoKidsRate = divorcedRate * 0.4; const divorcedWithKidsRate = divorcedRate * 0.6; switch(inputs.maritalStatus) { case 'unmarried': maritalStatusModifier = unmarriedRate; break; case 'divorced_no_kids': maritalStatusModifier = divorcedNoKidsRate; break; case 'divorced_with_kids': maritalStatusModifier = divorcedWithKidsRate; break; case 'unmarried_or_divorced': maritalStatusModifier = unmarriedRate + divorcedRate; break; case 'any': default: maritalStatusModifier = 1.0; break; } basePopForAge *= maritalStatusModifier; const basePopGendered = basePopForAge * (inputs.gender === 'male' ? maleRatio : femaleRatio); basePopulation += basePopGendered; let eligibleFromAge = 0; for (const key in db.personas) { const eduPass = (inputs.education === 'any') || (inputs.education === 'college' && ['c','b','m'].includes(key[0])) || (inputs.education === 'bachelor' && ['b','m'].includes(key[0])) || (inputs.education === 'master' && key[0] === 'm'); if (!eduPass) continue; const p = db.personas[key]; let adjustedIncome = inputs.income; if (inputs.income >= 15000 && age < 30) { potentialModeActive = true; adjustedIncome = inputs.income * (1 - ((30 - age) * 0.1)); } const incomeIsOutlier = (key === 'master' && adjustedIncome < 10000 && adjustedIncome > 0) || (key === 'bachelor' && adjustedIncome < 6000 && adjustedIncome > 0); const assetsIsOutlier = (key === 'other' && inputs.assets >= 500) || (key === 'college' && inputs.assets >= 1000); if (incomeIsOutlier || assetsIsOutlier) outlierModeActive = true; const p_income = incomeIsOutlier ? db.universalProb.income(adjustedIncome) : p.i(adjustedIncome); const p_assets = assetsIsOutlier ? db.universalProb.assets(inputs.assets) : p.a(inputs.assets); let p_house; if (inputs.assets >= 500) { p_house = inputs.house === 'any' ? 1 : inputs.house === 'owned_any' ? 0.98 : 0.85; } else if (inputs.assets >= 200) { p_house = inputs.house === 'any' ? 1 : inputs.house === 'owned_any' ? 0.95 : 0.75; } else if (inputs.assets >= 100) { p_house = inputs.house === 'any' ? 1 : inputs.house === 'owned_any' ? 0.88 : 0.60; } else { p_house = p.h(inputs.house); } const p_height = inputs.height > 0 ? (db.heightDist[inputs.gender]?.[inputs.height] || 0) : 1; const passRate = p_income * p_assets * p_house * p_height; eligibleFromAge += basePopGendered * (loc.e[key[0]] || 0) * passRate; } totalEligible += eligibleFromAge; } return { total: totalEligible, base: basePopulation }; }
    
    function handleCalculate(isSavingForComparison, isResetting = false) {
        if (!isResetting) {
             elements.loader.classList.add('active');
        }
        setTimeout(() => {
            const inputs = {};
            const formElements = elements.form.elements;
            for (const el of formElements) {
                if (el.name) {
                     if (['minAge', 'maxAge'].includes(el.id)) {
                        inputs[el.name] = parseInt(el.value, 10);
                     } else if (['height', 'income', 'assets'].includes(el.name)) {
                        inputs[el.name] = parseInt(el.value, 10) || 0;
                    } else {
                        inputs[el.name] = el.value;
                    }
                }
            }
            inputs.displayValues = getDisplayValues(formElements);

            const { total: totalResult, base: basePopulation } = calculatePopulation(inputs);
            const passRate = basePopulation > 0 ? totalResult / basePopulation : 0;
            const dynamicRatios = getDynamicRatios(passRate);
            const marketSize = totalResult * dynamicRatios.activeRate;
            const potentialPool = marketSize * dynamicRatios.matchRate;

            const impacts = [];
            const activeFilters = Object.keys(db.filterLabels).filter(key => inputs[key] !== 'any' && inputs[key] !== 0);

            activeFilters.forEach(key => {
                const tempInputs = {...inputs, [key]: (typeof inputs[key] === 'string' ? 'any' : 0)};
                const { total: resultWithoutFilter } = calculatePopulation(tempInputs);
                const passRateForImpact = resultWithoutFilter > 0 ? totalResult / resultWithoutFilter : 0;
                impacts.push({ label: db.filterLabels[key], strength: (1 - passRateForImpact) * 100 });
            });
            
            const currentResult = {
                total: totalResult, market: marketSize, potential: potentialPool,
                competition: getCompetitionIndex(passRate), impacts: impacts,
                basePop: basePopulation, passRate: passRate, inputs: inputs
            };
            
            if (isSavingForComparison) {
                savedResultForComparison = currentResult;
                elements.saveBtn.disabled = true;
                elements.saveBtn.innerHTML = '<i class="fas fa-check"></i> å·²ä¿å­˜';
            } else if (savedResultForComparison) {
                renderComparison(savedResultForComparison, currentResult);
                savedResultForComparison = null; 
                elements.saveBtn.disabled = false;
                elements.saveBtn.innerHTML = '<i class="fas fa-save"></i> ä¿å­˜å¯¹æ¯”';
            }
            
            updateUI(currentResult);
            elements.loader.classList.remove('active');
        }, 50);
    }
    
    function getDisplayValues(formElements) {
        const displayValues = {};
         for (const el of formElements) {
            if (el.name && el.value && el.value !== 'any' && el.value !== '0' && !['minAge', 'maxAge'].includes(el.id)) {
                 const labelEl = document.querySelector(`label[for=${el.id}]`);
                 const labelText = labelEl ? labelEl.innerText.trim() : el.name;
                 const valueText = el.options ? el.options[el.selectedIndex].text : el.value;
                 displayValues[labelText] = valueText;
            }
         }
         displayValues['å¹´é¾„'] = `${formElements.minAge.value} - ${formElements.maxAge.value} å²`;
         return displayValues;
    }

    function renderComparison(result1, result2) {
        const r1_inputs = result1.inputs.displayValues;
        const r2_inputs = result2.inputs.displayValues;
        const allKeys = [...new Set([...Object.keys(r1_inputs), ...Object.keys(r2_inputs)])];
        
        // This function now adds "data-label" attributes for the responsive CSS to work
        const renderRow = (label, val1, val2, isHeader = false) => {
            if(isHeader) {
                 return `<tr class="header-row"><th colspan="3">${label}</th></tr>`;
            }
            const highlight = val1 !== val2 ? 'style="background-color: #fff8e1;"' : '';
            return `
                <tr ${highlight}>
                    <td data-label="æŒ‡æ ‡" class="label-col">${label}</td>
                    <td data-label="å¯¹æ¯”é¡¹ 1">${val1}</td>
                    <td data-label="å¯¹æ¯”é¡¹ 2">${val2}</td>
                </tr>`;
        };
        
        let criteriaRows = '';
        allKeys.forEach(key => {
            const val1 = r1_inputs[key] || 'ä¸é™';
            const val2 = r2_inputs[key] || 'ä¸é™';
            criteriaRows += renderRow(key, val1, val2);
        });
        
        const html = `
            <table class="comparison-table">
                <thead>
                    <tr class="header-row"><th>æŒ‡æ ‡</th><th>å¯¹æ¯”é¡¹ 1</th><th>å¯¹æ¯”é¡¹ 2</th></tr>
                </thead>
                <tbody>
                    ${renderRow("ç†è®ºç¬¦åˆæ€»äººæ•°", formatNumber(result1.total), formatNumber(result2.total))}
                    ${renderRow("æ´»è·ƒå¯»ç¼˜äººæ•°", formatNumber(result1.market), formatNumber(result2.market))}
                    ${renderRow("å®é™…åŒ¹é…æ± ", formatNumber(result1.potential), formatNumber(result2.potential))}
                    ${renderRow("ç«äº‰æŒ‡æ•°", `<span style="color:${result1.competition.color}; font-weight:bold;">${result1.competition.label}</span>`, `<span style="color:${result2.competition.color}; font-weight:bold;">${result2.competition.label}</span>`)}
                    ${renderRow("ç»¼åˆç­›é€‰é€šè¿‡ç‡", `${(result1.passRate * 100).toFixed(3)}%`, `${(result2.passRate * 100).toFixed(3)}%`)}
                    ${renderRow("ç­›é€‰æ¡ä»¶å¯¹æ¯”", null, null, true)}
                    ${criteriaRows}
                </tbody>
            </table>
        `;
        elements.comparisonContent.innerHTML = html;
        elements.comparisonSection.style.display = 'block';
        elements.comparisonSection.scrollIntoView({ behavior: 'smooth' });
    }
    
    // ... all other functions like formatNumber, renderImpactChart, updateUI, setupTooltips remain the same ...
    function formatNumber(num) { const n = Math.round(num); if (n < 10) return "&lt;10 äºº"; if (n >= 10000) return `çº¦ ${(n / 10000).toFixed(2)} ä¸‡äºº`; return `çº¦ ${n.toLocaleString('en-US')} äºº`; }
    function renderImpactChart(impacts) { const sorted = impacts.sort((a,b) => b.strength - a.strength); const labels = sorted.map(i => i.label); const data = sorted.map(i => i.strength); const backgroundColors = data.map(s => s > 70 ? 'rgba(217,83,79,0.7)' : s > 40 ? 'rgba(240,173,78,0.7)' : 'rgba(92,184,92,0.7)'); if (impactChart) impactChart.destroy(); impactChart = new Chart(elements.impactChartCanvas, { type: 'bar', data: { labels, datasets: [{ label: 'ç­›é€‰å¼ºåº¦ (%)', data: data, backgroundColor: backgroundColors }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `ç­›é€‰å¼ºåº¦: ${c.raw.toFixed(1)}%` } } }, scales: { x: { beginAtZero: true, max: 100, ticks: { callback: (v) => v + '%' } } } } }); }
    function updateUI(result) { elements.resTotal.textContent = formatNumber(result.total); elements.resMarket.textContent = formatNumber(result.market); elements.resPotential.textContent = formatNumber(result.potential); elements.resCompetition.textContent = result.competition.label; elements.resCompetition.style.color = result.competition.color; elements.resBasePop.textContent = formatNumber(result.basePop); elements.resPassRate.textContent = `${(result.passRate * 100).toFixed(3)}%`; let summaryHTML = ''; Object.entries(result.inputs.displayValues).forEach(([key, value]) => { summaryHTML += `<li><strong>${key}:</strong> ${value}</li>`; }); elements.criteriaSummary.innerHTML = summaryHTML; let modeText = ''; if(outlierModeActive) modeText += 'æ£€æµ‹åˆ°éå…¸å‹ç”»åƒï¼Œå·²å¯ç”¨ç¦»ç¾¤å€¼åˆ†æã€‚'; if(potentialModeActive) modeText += 'æ£€æµ‹åˆ°é«˜æ”¶å…¥ä¸å¹´è½»ç»„åˆï¼Œå·²å¯ç”¨æ½œåŠ›åŠ æƒã€‚'; elements.calcModeDisplay.style.display = modeText ? 'block' : 'none'; elements.calcModeDisplay.textContent = modeText; renderImpactChart(result.impacts); }
    function setupTooltips() { document.body.addEventListener('mouseover', e => { if (e.target.classList.contains('help-icon')) { elements.tooltip.innerHTML = e.target.dataset.tooltip; elements.tooltip.style.display = 'block'; document.body.appendChild(elements.tooltip); const rect = e.target.getBoundingClientRect(); elements.tooltip.style.left = `${rect.left + window.scrollX}px`; elements.tooltip.style.top = `${rect.top + window.scrollY - elements.tooltip.offsetHeight - 5}px`; } }); document.body.addEventListener('mouseout', e => { if (e.target.classList.contains('help-icon')) { elements.tooltip.style.display = 'none'; } }); }

    init();
});
</script>
</body>
</html>```
